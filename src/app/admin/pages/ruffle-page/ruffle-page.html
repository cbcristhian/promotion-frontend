<div class="max-w-3xl mx-auto p-4 space-y-6">

  <div class="card bg-base-100 shadow">
    <div class="card-body">
      <h2 class="card-title">Parking Raffle</h2>
      <p class="text-sm text-base-content/70">
        Manually assign parking spots to residents using a fair raffle.
      </p>

      <div class="card-actions justify-end mt-4">
        <button
          class="btn btn-primary"
          [disabled]="isRunning()"
          (click)="runRaffle()"
        >
          @if (isRunning()) {
            <span class="loading loading-spinner loading-sm"></span>
            Running...
          } @else {
            Run Raffle
          }
        </button>
      </div>
    </div>
  </div>

  @if (latestResource.value()) {
    <div class="card bg-base-100 shadow">
      <div class="card-body space-y-4">
        <h3 class="card-title text-lg">Latest Parking Assignment</h3>

        <div class="space-y-3">
          @for (a of latestResource.value()?.latestRaffle?.residents; track a.residentId) {

            <div class="border rounded-xl p-4 bg-base-200">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">

                <div>
                  <p class="text-xs opacity-70">Resident</p>
                  <p class="font-semibold">{{ a.name }}</p>
                </div>

                <div>
                  <p class="text-xs opacity-70">Apartment</p>
                  <p class="font-medium">#{{ a.apartmentNumber }}</p>
                </div>

                <div>
                  <p class="text-xs opacity-70">Assigned Spot</p>

                  @if (a.parkingSpotId) {
                    <span class="badge badge-primary badge-lg">
                      Spot {{ a.parkingSpotId }}
                    </span>
                  } @else {
                    <span class="badge badge-error badge-lg">
                      No Spot Assigned
                    </span>
                  }
                </div>

              </div>
            </div>

          }
        </div>

        <div class="text-right text-xs opacity-60">
          Ran on: {{ latestResource.value()?.latestRaffle?.executedAt | date}}
        </div>
      </div>
    </div>
  }

</div>
